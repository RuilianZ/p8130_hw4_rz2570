---
titie: "P8130 Homework 4"
author: "Ruiiian Zhang"
date: "11/9/2021"
output: pdf_document
---


```{r, message = FALSE}
library(tidyverse)
```


## Problem 1

Proof: $\sum_{i=1}^{k} \sum_{j=1}^{n_i} (y_{ij}-\bar{\bar{y}})^2 = \sum_{i=1}^{k} \sum_{j=1}^{n_i} (y_{ij}-\bar{y_i})^2 + \sum_{i=1}^{k} \sum_{j=1}^{n_i} (\bar{y_i}-\bar{\bar{y}})^2$  


$\sum_{i=1}^{k} \sum_{j=1}^{n_i} (y_{ij}-\bar{\bar{y}})^2 \\ = \sum_{i=1}^{k} \sum_{j=1}^{n_i} (y_{ij}-\bar{y_i} + \bar{y_i} - \bar{\bar{y}})^2 \\ =  \sum_{i=1}^{k} \sum_{j=1}^{n_i} (y_{ij}-\bar{y_i})^2 + \sum_{i=1}^{k} \sum_{j=1}^{n_i} (\bar{y_i}-\bar{\bar{y}})^2 + 2\sum_{i=1}^{k} \sum_{j=1}^{n_i} (y_{ij} - \bar{y_i}) (\bar{y_i} - \bar{\bar{y}})$

Since $\sum_{j=1}^{n_i} (y_{ij} - \bar{y_i}) = n_i\bar{y_i} - n_i\bar{y_i} = 0$

We have $2\sum_{i=1}^{k} \sum_{j=1}^{n_i} (y_{ij} - \bar{y_i}) (\bar{y_i} - \bar{\bar{y}}) = 0$

Thus $\sum_{i=1}^{k} \sum_{j=1}^{n_i} (y_{ij}-\bar{\bar{y}})^2 = \sum_{i=1}^{k} \sum_{j=1}^{n_i} (y_{ij}-\bar{y_i})^2 + \sum_{i=1}^{k} \sum_{j=1}^{n_i} (\bar{y_i}-\bar{\bar{y}})^2$



## Problem 2

```{r}
crash_df = read_csv("data/crash.csv")
```

### a)

```{r}
descrip_groups = function(group) {
  
  mean = mean(group, na.rm = TRUE)
  range = max(group, na.rm = TRUE) - min(group, na.rm = TRUE)
  sd = sd(group, na.rm = TRUE)
  
  return(
    tibble(
      mean = mean,
      range = range,
      sd = sd
    )
  )
  
}

descrip_groups(crash_df$pedestrian)

descrip_results = map(crash_df, descrip_groups)


bind_rows(
    descrip_results$pedestrian, 
    descrip_results$bicycle,
    descrip_results$car
  ) %>% 
  mutate(
    crash_type = c("pedesterian", "bicycle", "car")) %>% 
  relocate(crash_type) %>% 
  knitr::kable(digits = 3)
```

* Patients with pedestrian crash has the highest average PTSD score of 37.875, compared to the average score of 32.500 in bicycle group and 23.429 in car group.  
* The range of PTSD score in pedestrian group is 14, which is slightly wider than the bicycle group (11) and the car group (11).  
* Patients with pedestrian crash has the highest standard deviation of PTSD score of 5.436, compared to the standard deviation of 4.062 in bicycle group and 3.867 in car group.  

### b)

$H_0$: All the group means are equal.  
$H_1$: Not all the group means are equal.

```{r}
crash_df = 
  pivot_longer(
    data = crash_df,
    cols = pedestrian:car,
    names_to = "crash_type",
    values_to = "ptsd_score"
  )

crash_anova = aov(ptsd_score ~ factor(crash_type), data = crash_df) 

summary(crash_anova)

f_stats = summary(crash_anova)[[1]][["F value"]][1]
f_crit = qf(0.99, 2, 22)
```

$F_{stats} = 19.533$  
$F_{crit} = 5.719$  
$F_{stats} > F_{crit}$  

With a type I error of 0.01, we have enough evidence to reject $H_0$. We can draw a conclusion that not all the group means of PTSD score are equal

```{r}

```



